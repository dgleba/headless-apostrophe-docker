{% macro icon(class) %}
  <svg class="{{ class }}">
    <g>
      <circle cx="16" cy="16" r="15.12"></circle>
      <path d="M16.14 9.93L22.21 16l-6.07 6.07M8.23 16h13.98"></path>
    </g>
  </svg>
{% endmacro %}

{% macro menubar(menus, children) %}

  {% if (children | int) === children %} {# if children is an integer, it's coming from a single page, otherwise from home #}
    {% set onePage = true %}
  {% endif %}

  <nav class="at_menu {%- if onePage %} at_menu--appear {%- endif %}">
      {% for menu in menus %}

        {% set slug = '/' %}
        {% if not onePage %}                  {# if home template #}
          {% for page in children %}          {# browse pages #}
            {% if page._id === menu.pageId %} {# compare with linked pages to menus #}
              {% set slug = page.slug %}      {# get slug if existing #}
            {% endif %}
          {% endfor %}
        {% endif %}

        <nav
          class="at_menu__{{ loop.index }}
            {%- if onePage -%}
              {% if children === loop.index %} at_menu__{{ loop.index }}--appear at_menu__{{ loop.index }}--appeared
              {%- else %} at_menu__{{ loop.index  }}--disappear{%- endif -%}
            {%- else %} attr
            {%- endif -%}"
          page={{ loop.index }}
          url={{ slug }}
        >
          {% if onePage %}
            <span class="at_menu__back attr-1-level">
              {{ icon("at_menu icon attr-2-levels") }}
              {{ icon("at_menu icon icon--hidden attr-2-levels") }}
            </span>
            <span class="at_menu__back breadcrumb attr-1-level">Accueil</span>
          {% endif %}
          <span class="at_menu title {%- if not onePage %} attr-1-level {%- endif %}">{{ menu.title }}</span>
        </nav>

      {% endfor %}
  </nav>
{% endmacro %}