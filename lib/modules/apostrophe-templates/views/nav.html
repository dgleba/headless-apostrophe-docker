{% macro icon(class) %}
  <svg class="{{ class }}">
    <g>
      <circle cx="16" cy="16" r="15.12"></circle>
      <path d="M16.14 9.93L22.21 16l-6.07 6.07M8.23 16h13.98"></path>
    </g>
  </svg>
{% endmacro %}

{% macro menubar(menus, children, showPageTitle) %}

  {% set homePage = true %}
  {% if (children | int) === children %} {# if children is an integer, it's coming from a single page, otherwise from home #}
    {% set homePage = false %}
  {% endif %}

  <nav class="at_menu {%- if not homePage %} at_menu--appear {%- endif %}">
      {% for menu in menus %}

        {% set slug = '/' %}
        {% if homePage %}                  {# if home template #}
          {% for page in children %}          {# browse pages #}
            {% if page._id === menu.pageId %} {# compare with linked pages to menus #}
              {% set slug = page.slug %}      {# get slug if existing #}
            {% endif %}
          {% endfor %}
        {% endif %}

        <nav
          class="at_menu__{{ loop.index }}
            {%- if homePage %} attr
            {%- else -%}
              {% if children === loop.index %} at_menu__{{ loop.index }}--appear at_menu__{{ loop.index }}--appeared
              {%- else %} at_menu__{{ loop.index  }}--disappear{%- endif -%}
            {%- endif -%}"
          page={{ loop.index }}
          url={{ slug }}
        >
          {% if not homePage %}
            <span class="at_menu__back" page={{ loop.index }} url="/ {%- if showPageTitle -%} {{ menu.slug }} {%- endif -%}">
              {{ icon("at_menu icon") }}
              {{ icon("at_menu icon icon--hidden") }}
            </span>
            <div class="at_menu__back breadcrumb">
              <span class="breadcrumb--root" page={{ loop.index }} url="/">Accueil</span>
              {%- if showPageTitle %} / <span class="breadcrumb--list" page={{ loop.index }} url="{{ menu.slug }}">{{ menu.title }}</span>{% endif %}
            </div>
          {% endif %}
          <span class="at_menu title {%- if homePage %} attr-1-level {%- endif %}" title="{%- if homePage -%} {{ menu.title }} {%- else -%} Accueil {%- endif -%}">
            {%- if showPageTitle -%} {{ showPageTitle }} {%- else -%} {{ menu.title }} {%- endif -%}
          </span>
        </nav>

      {% endfor %}
  </nav>
{% endmacro %}